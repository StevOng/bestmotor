{% extends 'base_katalog.html' %}

{% load static %}

{% block banner %}
<div class="bg-customBlue px-6 md:px-12 py-6 text-white">
    <p class="text-2xl font-bold">Katalog Rem</p>
    <span class="flex flex-row mt-4 text-sm">
        Beranda >
        <p class="ml-1 text-gray-200">Transmisi ></p>
        <p class="ml-1 text-gray-400">Rem</p>
    </span>
</div>
{% endblock %}

{% block content %}
<div class="px-6 py-5 md:px-12">
    <div class="py-2">
      <div class="flex flex-row justify-between items-center">
        <p class="font-semibold">Rekomendasi Rem</p>
        <div class="flex gap-4">
          <button
            id="scrollLeft"
            class="bg-white text-customBlue p-2 px-3 rounded-full shadow border border-gray-300"
          >
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <button
            id="scrollRight"
            class="bg-white text-customBlue p-2 px-3 rounded-full shadow border border-gray-300"
          >
            <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>
      </div>
      <div
        id="scrollContainer"
        class="flex flex-row py-2 overflow-x-auto gap-5 scroll-smooth no-scrollbar"
      >
        <div class="flex flex-col p-2 min-w-44">
          <img
            src="{% static 'images/logo.png' %}"
            class="w-auto h-28 md:h-32 items-center"
          />
          <p class="text-gray-500">Rem</p>
          <p>Handle Rem Motor</p>
          <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
          <button
            class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]"
          >
            Deskripsi
          </button>
        </div>
        <div class="flex flex-col p-2 min-w-44">
          <img
            src="{% static 'images/logo.png' %}"
            class="w-auto h-28 md:h-32 items-center"
          />
          <p class="text-gray-500">Oil Motor</p>
          <p>Yamalube XP-50</p>
          <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
          <button
            class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]"
          >
            Deskripsi
          </button>
        </div>
        <div class="flex flex-col p-2 min-w-44">
          <img
            src="{% static 'images/logo.png' %}"
            class="w-auto h-28 md:h-32 items-center"
          />
          <p class="text-gray-500">Oil Motor</p>
          <p>Yamalube XP-50</p>
          <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
          <button
            class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]"
          >
            Deskripsi
          </button>
        </div>
        <div class="flex flex-col p-2 min-w-44">
          <img
            src="{% static 'images/logo.png' %}"
            class="w-auto h-28 md:h-32 items-center"
          />
          <span>
            <p class="text-gray-500">Oil Motor</p>
            <p>Yamalube XP-50</p>
            <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
          </span>
          <button
            class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]"
          >
            Deskripsi
          </button>
        </div>
        <div class="flex flex-col p-2 min-w-44">
          <img
            src="{% static 'images/logo.png' %}"
            class="w-auto h-28 md:h-32 items-center"
          />
          <span>
            <p class="text-gray-500">Oil Motor</p>
            <p>Yamalube XP-50</p>
            <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
          </span>
          <button
            class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]"
          >
            Deskripsi
          </button>
        </div>
      </div>
    <div class="pt-5">
        <p class="font-semibold">Item Lainnya</p>
        <div
        id="productContainer" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 grid-rows-3 py-2 overflow-hidden gap-5"></div>
        <!-- Pagination -->
        <div class="flex justify-center mt-4 space-x-2">
            <button id="prevPage" class="bg-white text-customBlue p-2 px-3 rounded-full shadow border-gray-300"><i class="fa-solid fa-arrow-left"></i></button>
            <span id="pageNumbers" class="flex"></span>
            <button id="nextPage" class="bg-white text-customBlue p-2 px-3 rounded-full shadow border-gray-300"><i class="fa-solid fa-arrow-right"></i></button>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    const allItems = Array.from({ length: 48 }, (_, i) => 
    `<div class="flex flex-col p-2 md:min-w-44">
        <img src="{% static 'images/logo.png' %}" class="w-auto h-28 md:h-32 items-center" />
        <span>
            <p class="text-gray-500">Rem</p>
            <p>Handle Rem Motor</p>
            <p class="py-2 font-semibold text-orange-400">Rp 45.000</p>
        </span>
        <a href="{% url 'deskripsi' %}" class="py-1 border rounded-md text-sm text-center text-white bg-customBlue hover:bg-[#243F6B]">
            Deskripsi
        </a>
    </div>`
);

let currentPage = 1;
let itemsPerPage = getItemsPerPage();
let totalPages = Math.ceil(allItems.length / itemsPerPage);

function getItemsPerPage() {
    if (window.matchMedia("(min-width: 1024px)").matches) {
        return 18;
    } else if (window.matchMedia("(min-width: 768px)").matches) {
        return 12;
    } else {
        return 6;
    }
}

function updatePagination(page) {
    const pageNumbers = document.getElementById("pageNumbers");
    pageNumbers.innerHTML = "";
    
    const createButton = (text, pageNumber, isActive = false, isDisabled = false) => {
        const button = document.createElement("button");
        button.textContent = text;
        button.className = `page-btn bg-white mx-1 p-2 px-3 rounded-full shadow ${
            isActive ? 'text-customBlue font-bold' : 'text-gray-400'
        }`;
        if (isDisabled){
            button.disabled = true;
        } else if(!isNaN(pageNumber)) {
            button.dataset.page = pageNumber;
            button.addEventListener("click", () => {
                currentPage = pageNumber;
                renderItems(currentPage);
            });
        }
        return button;
    };

    if (totalPages <= 5) {
        // Jika halaman kurang dari atau sama dengan 5, tampilkan semua angka
        for (let i = 1; i <= totalPages; i++) {
            pageNumbers.appendChild(createButton(i, i, i === page));
        }
    } else {
        // Selalu tampilkan halaman pertama
        pageNumbers.appendChild(createButton(1, 1, page === 1));

        if (page > 3) {
            pageNumbers.appendChild(createButton("...", null, false, true));
        }

        let start = Math.max(2, page - 1);
        let end = Math.min(totalPages - 1, page);

        for (let i = start; i <= end; i++) {
            pageNumbers.appendChild(createButton(i, i, i === page));
        }

        if (page < totalPages - 2) {
            pageNumbers.appendChild(createButton("...", null, false, true));
        }

        // Selalu tampilkan halaman terakhir
        pageNumbers.appendChild(createButton(totalPages, totalPages, page === totalPages));
    }

    // Disable tombol prev/next jika di halaman pertama atau terakhir
    document.getElementById("prevPage").disabled = page === 1;
    document.getElementById("nextPage").disabled = page === totalPages;
}

// Panggil updatePagination setelah renderItems
function renderItems(page) {
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    document.getElementById("productContainer").innerHTML = allItems.slice(start, end).join("");
    updatePagination(page);
}

document.getElementById("prevPage").addEventListener("click", () => {
    if (currentPage > 1) {
        currentPage--;
        renderItems(currentPage);
    }
});

document.getElementById("nextPage").addEventListener("click", () => {
    if (currentPage < totalPages) {
        currentPage++;
        renderItems(currentPage);
    }
});

window.addEventListener("resize", () => {
    renderItems(currentPage);
});

renderItems(currentPage);

</script>
{% endblock %}